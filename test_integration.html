<!DOCTYPE html>
<html>
<head>
    <title>Integration Test</title>
</head>
<body>
    <h1>Testing Ilana Frontend-Backend Integration</h1>
    <button onclick="testRealFlow()">Test Real Word Add-in Flow</button>
    <div id="results"></div>

    <script>
        // Copy the exact configuration from the frontend
        const API_CONFIG = {
            baseUrl: 'https://ilanalabs-add-in.onrender.com',
            timeout: 120000,
            retryAttempts: 1
        };

        async function testRealFlow() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing real Word add-in flow...</p>';
            
            try {
                // Simulate the exact frontend flow
                const testText = "PROTOCOL SYNOPSIS: A Phase III, Randomized, Double-Blind, Placebo-Controlled Study to Evaluate the Efficacy and Safety of ABC-789 in Patients with Previously Treated Advanced Non-Small Cell Lung Cancer Harboring EGFR Exon 20 Insertion Mutations.";
                
                const payload = {
                    text: testText,
                    chunk_index: 0,
                    total_chunks: 1
                };
                
                console.log("üîç Sending comprehensive analysis request:", payload);
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);
                
                const response = await fetch(`${API_CONFIG.baseUrl}/analyze-comprehensive`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'X-Intelligence-Level': 'AI-Enhanced Protocol Analysis'
                    },
                    body: JSON.stringify(payload),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`Backend error: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log("‚úÖ Analysis complete:", result);
                
                // Check if we have suggestions
                const suggestionCount = result.suggestions ? result.suggestions.length : 0;
                const enterpriseEnabled = result.metadata ? result.metadata.enterprise_ai_enabled : false;
                const modelVersion = result.metadata ? result.metadata.model_version : 'unknown';
                
                results.innerHTML = `
                    <h3>‚úÖ Integration Test Results:</h3>
                    <p><strong>Status:</strong> SUCCESS</p>
                    <p><strong>Suggestions Found:</strong> ${suggestionCount}</p>
                    <p><strong>Enterprise AI:</strong> ${enterpriseEnabled ? 'ACTIVE' : 'INACTIVE'}</p>
                    <p><strong>Model Version:</strong> ${modelVersion}</p>
                    <p><strong>Backend Response Time:</strong> ${result.metadata?.processing_time || 'unknown'}s</p>
                    
                    <h4>Sample Suggestions:</h4>
                    ${result.suggestions ? result.suggestions.slice(0, 2).map(s => 
                        `<div style="border: 1px solid #ccc; padding: 10px; margin: 5px;">
                            <strong>Type:</strong> ${s.type} (${s.severity})<br>
                            <strong>Suggestion:</strong> ${s.suggestion}<br>
                            <strong>Confidence:</strong> ${s.backend_confidence}
                        </div>`
                    ).join('') : '<p>No suggestions returned</p>'}
                    
                    <h4>Raw Response:</h4>
                    <pre style="background: #f5f5f5; padding: 10px; overflow: auto; max-height: 200px;">${JSON.stringify(result, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('‚ùå Integration test failed:', error);
                results.innerHTML = `
                    <h3>‚ùå Integration Test Failed:</h3>
                    <p><strong>Error:</strong> ${error.message}</p>
                    <p>This indicates the frontend-backend integration is not working properly.</p>
                `;
            }
        }
    </script>
</body>
</html>