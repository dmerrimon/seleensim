<!DOCTYPE html>
<html>
<head>
    <title>Test Analyze Flow</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 16px; border: 1px solid #ddd; border-radius: 8px; }
        .test-button { background: #007acc; color: white; padding: 8px 16px; margin: 4px; border: none; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #005a9e; }
        .code-block { background: #f5f5f5; padding: 12px; border-radius: 4px; font-family: monospace; margin: 8px 0; }
        .note { color: #666; font-style: italic; font-size: 14px; margin-top: 8px; }
    </style>
</head>
<body>
    <h1>Ilana Analyze Flow Test Console</h1>
    
    <div class="test-section">
        <h2>1. Test Selection-First Flow</h2>
        <p>This simulates having text selected (>5 chars) and should trigger immediate analysis:</p>
        <div class="code-block">
// Test selection analysis (simulates selected text)
async function testSelectionFlow() {
    // Mock getSelectedText to return sample text
    const originalGetSelectedText = window.getSelectedText;
    window.getSelectedText = async () => "Patients will receive daily treatment";
    
    console.log("ðŸ§ª Testing selection flow...");
    await analyzeProtocol();
    
    // Restore original function
    window.getSelectedText = originalGetSelectedText;
}
        </div>
        <button class="test-button" onclick="testSelectionFlow()">Test Selection Flow</button>
        <div class="note">Should call /api/analyze with mode: "selection"</div>
    </div>

    <div class="test-section">
        <h2>2. Test No-Selection Modal Flow</h2>
        <p>This simulates no text selection (â‰¤5 chars) and should show the analysis options modal:</p>
        <div class="code-block">
// Test modal flow (simulates no selection)
async function testModalFlow() {
    // Mock getSelectedText to return empty
    const originalGetSelectedText = window.getSelectedText;
    window.getSelectedText = async () => "";
    
    console.log("ðŸ§ª Testing modal flow...");
    await analyzeProtocol();
    
    // Restore original function
    window.getSelectedText = originalGetSelectedText;
}
        </div>
        <button class="test-button" onclick="testModalFlow()">Test Modal Flow</button>
        <div class="note">Should show analysis options modal with 3 choices</div>
    </div>

    <div class="test-section">
        <h2>3. Test Truncated Document Analysis</h2>
        <p>This simulates choosing "Analyze document (truncated)" from the modal:</p>
        <div class="code-block">
// Test truncated document analysis
async function testTruncatedAnalysis() {
    console.log("ðŸ§ª Testing truncated document analysis...");
    
    // Mock document text
    const originalGetFullDocumentText = window.getFullDocumentText;
    window.getFullDocumentText = async () => "This is a sample protocol document with more than 20,000 characters...".repeat(500);
    
    await analyzeTruncatedDocument();
    
    // Restore original function
    window.getFullDocumentText = originalGetFullDocumentText;
}
        </div>
        <button class="test-button" onclick="testTruncatedAnalysis()">Test Truncated Analysis</button>
        <div class="note">Should call /api/analyze with mode: "document_truncated"</div>
    </div>

    <div class="test-section">
        <h2>4. Test Deep Analysis Queue</h2>
        <p>This simulates choosing "Queue deep analysis" from the modal:</p>
        <div class="code-block">
// Test deep analysis queue
async function testDeepAnalysis() {
    console.log("ðŸ§ª Testing deep analysis queue...");
    
    // Mock document text
    const originalGetFullDocumentText = window.getFullDocumentText;
    window.getFullDocumentText = async () => "This is a large protocol document that requires deep analysis...".repeat(1000);
    
    await queueDeepAnalysis();
    
    // Restore original function
    window.getFullDocumentText = originalGetFullDocumentText;
}
        </div>
        <button class="test-button" onclick="testDeepAnalysis()">Test Deep Analysis</button>
        <div class="note">Should call /api/optimize-document-async and show job queued message</div>
    </div>

    <div class="test-section">
        <h2>5. Test Button States</h2>
        <p>Test the analyze button's disabled and spinner states:</p>
        <div class="code-block">
// Test button states
function testButtonStates() {
    console.log("ðŸ§ª Testing button states...");
    
    // Test analyzing state
    setAnalyzeButtonState(true, "Analyzing...");
    console.log("Button should show spinner and be disabled");
    
    setTimeout(() => {
        // Reset button state after 3 seconds
        setAnalyzeButtonState(false, "Analyze");
        console.log("Button should be enabled and show 'Analyze' text");
    }, 3000);
}
        </div>
        <button class="test-button" onclick="testButtonStates()">Test Button States</button>
        <div class="note">Button should show spinner for 3 seconds then reset</div>
    </div>

    <div class="test-section">
        <h2>6. Test Modal Accessibility</h2>
        <p>Test modal keyboard navigation and focus management:</p>
        <div class="code-block">
// Test modal accessibility
function testModalAccessibility() {
    console.log("ðŸ§ª Testing modal accessibility...");
    
    // Show modal
    showAnalysisModal();
    console.log("Modal shown - try pressing ESC to close, TAB to navigate");
    
    // Test focus management
    const modal = document.getElementById('analysisModal');
    const firstOption = modal.querySelector('.modal-option');
    console.log("First option should be focused:", document.activeElement === firstOption);
}
        </div>
        <button class="test-button" onclick="testModalAccessibility()">Test Modal A11y</button>
        <div class="note">Modal should open with focus on first option, ESC should close</div>
    </div>

    <script>
        // Include these test functions in browser console when testing the add-in
        console.log("ðŸ“‹ Ilana Analyze Flow Test Console Loaded");
        console.log("Copy and paste the test functions above into your browser console when testing the Word add-in");
        console.log("Available test functions:");
        console.log("- testSelectionFlow()");
        console.log("- testModalFlow()");
        console.log("- testTruncatedAnalysis()");
        console.log("- testDeepAnalysis()");
        console.log("- testButtonStates()");
        console.log("- testModalAccessibility()");
    </script>
</body>
</html>